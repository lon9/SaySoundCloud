FROM node:alpine as build-env

ARG API_KEY
ARG AUTH_DOMAIN
ARG DATABASE_URL
ARG PROJECT_ID
ARG STORAGE_BUCKET
ARG MESSAGING_SENDER_ID
ARG APP_ID
ARG BASE_URL
ARG APP_TITLE
ARG APP_DESCRIPTION
ARG USE_FIREBASE
ARG SOUND_BASE_URL
ARG OG_SITE_NAME
ARG OG_URL
ARG OG_TITLE
ARG OG_DESCRIPTION
ARG OG_IMAGE
ARG TWITTER_CARD
ARG TWITTER_SITE
ARG PWA_NAME
ARG PWA_SHORTNAME
ARG PWA_DESCRIPTION

ENV API_KEY=${API_KEY}
ENV AUTH_DOMAIN=${AUTH_DOMAIN}
ENV DATABASE_URL=${DATABASE_URL}
ENV PROJECT_ID=${PROJECT_ID}
ENV BASE_URL=${BASE_URL}
ENV APP_TITLE=${APP_TITLE}
ENV APP_DESCRIPTION=${APP_DESCRIPTION}
ENV USE_FIREBASE=${USE_FIREBASE}
ENV SOUND_BASE_URL=${SOUND_BASE_URL}
ENV OG_SITE_NAME=${OG_SITE_NAME}
ENV OG_URL=${OG_URL}
ENV OG_TITLE=${OG_TITLE}
ENV OG_DESCRIPTION=${OG_DESCRIPTION}
ENV OG_IMAGE=${OG_IMAGE}
ENV TWITTER_CARD=${TWITTER_CARD}
ENV TWITTER_SITE=${TWITTER_SITE}
ENV PWA_NAME=${PWA_NAME}
ENV PWA_SHORTNAME=${PWA_SHORTNAME}
ENV PWA_DESCRIPTION=${PWA_DESCRIPTION}

WORKDIR /app
ADD . /app

RUN yarn install && \
    yarn build

FROM node:alpine

ARG API_KEY
ARG AUTH_DOMAIN
ARG DATABASE_URL
ARG PROJECT_ID
ARG BASE_URL
ARG APP_TITLE
ARG APP_DESCRIPTION
ARG USE_FIREBASE
ARG SOUND_BASE_URL
ARG OG_SITE_NAME
ARG OG_URL
ARG OG_TITLE
ARG OG_DESCRIPTION
ARG OG_IMAGE
ARG TWITTER_CARD
ARG TWITTER_SITE
ARG PWA_NAME
ARG PWA_SHORTNAME
ARG PWA_DESCRIPTION

ENV API_KEY=${API_KEY}
ENV AUTH_DOMAIN=${AUTH_DOMAIN}
ENV DATABASE_URL=${DATABASE_URL}
ENV PROJECT_ID=${PROJECT_ID}
ENV BASE_URL=${BASE_URL}
ENV APP_TITLE=${APP_TITLE}
ENV APP_DESCRIPTION=${APP_DESCRIPTION}
ENV USE_FIREBASE=${USE_FIREBASE}
ENV SOUND_BASE_URL=${SOUND_BASE_URL}
ENV OG_SITE_NAME=${OG_SITE_NAME}
ENV OG_URL=${OG_URL}
ENV OG_TITLE=${OG_TITLE}
ENV OG_DESCRIPTION=${OG_DESCRIPTION}
ENV OG_IMAGE=${OG_IMAGE}
ENV TWITTER_CARD=${TWITTER_CARD}
ENV TWITTER_SITE=${TWITTER_SITE}
ENV PWA_NAME=${PWA_NAME}
ENV PWA_SHORTNAME=${PWA_SHORTNAME}
ENV PWA_DESCRIPTION=${PWA_DESCRIPTION}

WORKDIR /app
COPY --from=build-env /app /app
